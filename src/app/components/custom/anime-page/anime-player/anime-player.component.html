<div class="player-container mt-20">
  <div class="select-wrapper">
    <tui-select class="select" #select [(ngModel)]="selectedDubber" [valueContent]="selectedDubber() + ' ' + dubberEpisodesCount(selectedDubber())">
      Выберите озвучку
      <tui-data-list *tuiDataList>
        <tui-opt-group label="Озвучки">
          <button
            *ngFor="let dabber of dubbersData().dubbers"
            tuiOption
            type="button"
            [value]="dabber"
          >
            {{ dabber }} {{ dubberEpisodesCount(dabber) }}
          </button>
        </tui-opt-group>
        <tui-opt-group label="Субтитры">
          <button
            tuiOption
            type="button"
            *ngFor="let subtitle of dubbersData().subtitles"
            [value]="subtitle"
          >
            {{ subtitle }} {{ dubberEpisodesCount(subtitle) }}
          </button>
        </tui-opt-group>
      </tui-data-list>
    </tui-select>

    <tui-select [disabled]="!selectedDubber()" class="select" #select [(ngModel)]="selectedPlayer" [valueContent]="selectedPlayer() + ' ' + playerEpisodesCount(selectedDubber(), selectedPlayer())">
      Выберите плеер
      <tui-data-list *tuiDataList>
        <tui-opt-group label="Озвучки">
          <button *ngFor="let player of playersData()" tuiOption type="button" [value]="player">
            {{ player }} {{ playerEpisodesCount(selectedDubber(), player) }}
          </button>
        </tui-opt-group>
      </tui-data-list>
    </tui-select>
  </div>

  <!-- Episodes navigation section -->
  <div class="episodes-section">
    <div class="episodes-header">
      <div class="episodes-info">
        <span class="episodes-title">Эпизоды</span>
        <span class="episodes-count">({{ currentEpisodesCount() }} эп.)</span>
      </div>
    </div>

    <div class="episodes-wrapper" #episodesWrapper>
      <div class="episodes-scroll-container">
        @for (item of playersDataWithEpisodes()[selectedDubber()]?.[selectedPlayer()] || []; track item.id) {
          <div 
            class="episode-item" 
            [class.selected]="selectedEpisode()?.id === item.id" 
            [class.watched]="isEpisodeWatched(item)"
            [class.current]="selectedEpisode()?.id === item.id"
            [attr.data-episode]="item.episode"
            (click)="setSelectedEpisode(item)"
          >
            <span class="episode-number">{{ item.episode }}</span>
            @if (isEpisodeWatched(item)) {
              <span class="episode-status">✓</span>
            }
          </div>
        }
      </div>
    </div>
  </div>

  <div class="player-wrapper w-full">
    <ani-player-iframe [url]="selectedEpisode()?.iframeUrl ?? ''" />
  </div>
</div>
